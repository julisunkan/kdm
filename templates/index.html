{% extends "base.html" %}

{% block title %}Home - KDP Keyword Research Tool{% endblock %}

{% block content %}
<div class="row">
    <!-- Main Search Section -->
    <div class="col-lg-8">
        <div class="card shadow-sm">
            <div class="card-header">
                <h4 class="mb-0">
                    <i class="fas fa-search text-primary"></i>
                    Keyword Research
                </h4>
            </div>
            <div class="card-body">
                <form id="searchForm" class="search-container">
                    <div class="mb-3">
                        <label for="keywordsInput" class="form-label">Enter Keywords</label>
                        <textarea 
                            class="form-control keyword-input" 
                            id="keywordsInput" 
                            rows="4" 
                            placeholder="Enter keywords separated by commas: keyword 1, keyword 2, keyword 3"
                            required
                        ></textarea>
                        <div class="form-text bulk-mode-label">
                            Single mode: Enter keywords separated by commas
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="bulkMode">
                                <label class="form-check-label" for="bulkMode">
                                    Bulk Mode (one keyword per line)
                                </label>
                            </div>
                        </div>
                        <div class="col-md-6 text-end">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-search"></i>
                                Search Keywords
                            </button>
                        </div>
                    </div>
                </form>
                
                <!-- Export Buttons -->
                <div class="export-buttons mb-3" style="display: none;" id="exportButtons">
                    <h6>Export Results:</h6>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-success export-btn" data-format="csv" disabled>
                            <i class="fas fa-file-csv"></i> CSV
                        </button>
                        <button type="button" class="btn btn-outline-primary export-btn" data-format="excel" disabled>
                            <i class="fas fa-file-excel"></i> Excel
                        </button>
                        <button type="button" class="btn btn-outline-danger export-btn" data-format="pdf" disabled>
                            <i class="fas fa-file-pdf"></i> PDF
                        </button>
                    </div>
                    <button type="button" class="btn btn-outline-secondary ms-2" id="saveSession" disabled>
                        <i class="fas fa-save"></i> Save Session
                    </button>
                    <button type="button" class="btn btn-outline-info ms-2" id="showInstructions">
                        <i class="fas fa-question-circle"></i> Help
                    </button>
                    <button type="button" class="btn btn-outline-primary ms-2" id="loadSession">
                        <i class="fas fa-folder-open"></i> Load Session
                    </button>
                </div>
                
                <!-- Inline Save Session Form -->
                <div id="saveSessionForm" class="mt-3" style="display: none;">
                    <div class="card">
                        <div class="card-body">
                            <h6><i class="fas fa-save"></i> Save Research Session</h6>
                            <div class="row">
                                <div class="col-md-8">
                                    <input type="text" class="form-control" id="sessionNameInput" placeholder="Enter session name..." maxlength="50">
                                </div>
                                <div class="col-md-4">
                                    <button type="button" class="btn btn-primary me-2" id="confirmSaveSession">Save</button>
                                    <button type="button" class="btn btn-secondary" id="cancelSaveSession">Cancel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Inline Load Session Form -->
                <div id="loadSessionForm" class="mt-3" style="display: none;">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6><i class="fas fa-folder-open"></i> Load Research Session</h6>
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="cancelLoadSession">
                                    <i class="fas fa-times"></i> Cancel
                                </button>
                            </div>
                            <div id="sessionsList">
                                <div class="text-center text-muted">
                                    <div class="spinner-border spinner-border-sm me-2"></div>
                                    Loading sessions...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Results Section -->
        <div class="mt-4">
            <div id="resultsContainer">
                <div class="text-center text-muted py-5">
                    <i class="fas fa-search fa-3x mb-3"></i>
                    <h5>Start Your Keyword Research</h5>
                    <p>Enter your keywords above to begin analyzing their potential for your KDP books.</p>
                </div>
            </div>
        </div>
        
        <!-- Charts Section -->
        <div class="row mt-4" id="chartsSection" style="display: none;">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">Keyword Scores</h6>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="scoreChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">Search Volume</h6>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="volumeChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Sidebar -->
    <div class="col-lg-4">
        <!-- Daily Trending Topics -->
        <div class="card shadow-sm mb-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-fire text-danger"></i>
                    Trending Topics Today
                </h5>
            </div>
            <div class="card-body">
                {% if trending_topics %}
                    <div class="trending-topics">
                        {% for topic in trending_topics %}
                        <div class="trending-item">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <button class="btn btn-link p-0 text-start trending-topic-btn" style="text-decoration: none;">
                                        {{ topic.topic }}
                                    </button>
                                    <div class="trending-source">{{ topic.source.replace('_', ' ').title() }}</div>
                                </div>
                                <span class="badge bg-primary">{{ topic.trend_score|round(1) }}</span>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-muted">No trending topics available. Check back later!</p>
                {% endif %}
            </div>
        </div>
        
        <!-- Quick Tips -->
        <div class="card shadow-sm">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-lightbulb text-warning"></i>
                    Research Tips
                </h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    <div class="list-group-item">
                        <strong>Green Keywords:</strong> Low competition, high opportunity
                    </div>
                    <div class="list-group-item">
                        <strong>Yellow Keywords:</strong> Moderate competition, decent potential
                    </div>
                    <div class="list-group-item">
                        <strong>Red Keywords:</strong> High competition, challenging to rank
                    </div>
                    <div class="list-group-item">
                        <strong>Tip:</strong> Focus on long-tail keywords for better conversion
                    </div>
                    <div class="list-group-item">
                        <strong>Strategy:</strong> Combine high and low competition keywords
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Inline Instructions Section -->
<div class="card mt-4" id="instructionsCard" style="display: none;">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
            <i class="fas fa-question-circle text-info"></i>
            How to Use the Keyword Research Tool
        </h5>
        <button type="button" class="btn btn-sm btn-outline-secondary" id="hideInstructions">
            <i class="fas fa-times"></i> Hide
        </button>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <h6><i class="fas fa-search"></i> Basic Search</h6>
                <ul>
                    <li>Enter keywords separated by commas</li>
                    <li>Use bulk mode for multiple keywords (one per line)</li>
                    <li>Click "Search Keywords" to analyze</li>
                </ul>
                
                <h6 class="mt-3"><i class="fas fa-chart-line"></i> Understanding Scores</h6>
                <ul>
                    <li><strong>Difficulty:</strong> How hard to rank (lower is better)</li>
                    <li><strong>Profitability:</strong> Potential profit (higher is better)</li>
                    <li><strong>Search Volume:</strong> Monthly searches estimate</li>
                </ul>
            </div>
            <div class="col-md-6">
                <h6><i class="fas fa-star"></i> Features</h6>
                <ul>
                    <li>Save keywords to favorites</li>
                    <li>Copy keywords to clipboard</li>
                    <li>Export results to CSV, Excel, or PDF</li>
                    <li>Save research sessions</li>
                </ul>
                
                <h6 class="mt-3"><i class="fas fa-lightbulb"></i> Best Practices</h6>
                <ul>
                    <li>Research seasonal trends</li>
                    <li>Analyze competitor keywords</li>
                    <li>Focus on niche-specific terms</li>
                    <li>Consider buyer intent keywords</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Show export buttons when results are available
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            const resultsContainer = document.getElementById('resultsContainer');
            const exportButtons = document.getElementById('exportButtons');
            const chartsSection = document.getElementById('chartsSection');
            const saveSessionBtn = document.getElementById('saveSession');
            
            if (resultsContainer && resultsContainer.querySelector('table')) {
                exportButtons.style.display = 'block';
                chartsSection.style.display = 'block';
                saveSessionBtn.disabled = false;
                
                // Enable export buttons
                document.querySelectorAll('.export-btn').forEach(btn => {
                    btn.disabled = false;
                });
            }
        });
    });
    
    const resultsContainer = document.getElementById('resultsContainer');
    if (resultsContainer) {
        observer.observe(resultsContainer, { childList: true, subtree: true });
    }
    
    // Show instructions inline on first visit
    if (!localStorage.getItem('kdp-instructions-shown')) {
        setTimeout(() => {
            const instructionsCard = document.getElementById('instructionsCard');
            if (instructionsCard) {
                instructionsCard.style.display = 'block';
                instructionsCard.scrollIntoView({ behavior: 'smooth' });
                localStorage.setItem('kdp-instructions-shown', 'true');
            }
        }, 1000);
    }
    
    // Handle show/hide instructions
    const showInstructionsBtn = document.getElementById('showInstructions');
    const hideInstructionsBtn = document.getElementById('hideInstructions');
    const instructionsCard = document.getElementById('instructionsCard');
    
    if (showInstructionsBtn) {
        showInstructionsBtn.addEventListener('click', () => {
            instructionsCard.style.display = 'block';
            instructionsCard.scrollIntoView({ behavior: 'smooth' });
        });
    }
    
    if (hideInstructionsBtn) {
        hideInstructionsBtn.addEventListener('click', () => {
            instructionsCard.style.display = 'none';
        });
    }
});
</script>
{% endblock %}
